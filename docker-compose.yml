version: '3.8'

services:
  # 1. 您的Nuxt应用服务
  app:
    image: ghcr.io/cthaat/nekotribe:shadcn-web
    restart: always
    ports:
      - '30001:3000'
    env_file:
      - ./.env.docker
    networks:
      - neko-network
    extra_hosts:
      - 'host.docker.internal:host-gateway'
    depends_on:
      - redis

  # 2. Redis服务
  redis:
    image: redis:7-alpine
    restart: always
    env_file:
      - ./.env.docker
    command: redis-server --requirepass '123456..a'
    networks:
      - neko-network

  # 3. Nginx服务
  nginx:
    image: nginx:1.27-alpine
    container_name: nekotribe-nginx-dev
    restart: unless-stopped
    ports:
      - '30002:80'
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ./upload:/usr/share/nginx/upload:ro
    extra_hosts:
      - 'host.docker.internal:host-gateway'
    networks:
      - neko-network
    depends_on:
      - app

  oracle19c:
    image: container-registry.oracle.com/database/enterprise:19.3.0.0
    container_name: oracle19c
    ports:
      - '5501:1521' # Oracle SQL*Net 端口（供 DataGrip 使用）
      - '5500:5500' # Oracle EM Express 控制台
    environment:
      - ORACLE_PWD=123456..a
    volumes:
      - ./data/oracle-data:/opt/oracle/oradata # 数据持久化目录（相对路径）
      - ./data/oracle-init:/opt/oracle/scripts/setup:ro # 初始化脚本目录
    healthcheck: # 可选，用于自动检测数据库是否健康
      test: ['CMD', 'lsnrctl', 'status']
      interval: 30s
      timeout: 10s
      retries: 10
    restart: unless-stopped
    networks:
      - neko-network

networks:
  neko-network:
    driver: bridge

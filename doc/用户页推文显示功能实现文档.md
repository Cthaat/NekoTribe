# ç”¨æˆ·é¡µæ¨æ–‡æ˜¾ç¤ºåŠŸèƒ½å®ç°æ–‡æ¡£

## æ¦‚è¿°

åœ¨ç”¨æˆ·ä¸ªäººèµ„æ–™é¡µé¢ (`/user/[id]/profile`) æ·»åŠ äº†è¯¥ç”¨æˆ·å‘å¸ƒçš„æ¨æ–‡åˆ—è¡¨æ˜¾ç¤ºåŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### å‰ç«¯åŠŸèƒ½

1. âœ… æ˜¾ç¤ºç”¨æˆ·å‘å¸ƒçš„æ‰€æœ‰æ¨æ–‡
2. âœ… æ¨æ–‡åˆ—è¡¨åˆ†é¡µå±•ç¤ºï¼ˆæ¯é¡µ15æ¡ï¼‰
3. âœ… æ”¯æŒæ¨æ–‡äº¤äº’æ“ä½œï¼š
   - ç‚¹èµ/å–æ¶ˆç‚¹èµ
   - æ”¶è—/å–æ¶ˆæ”¶è—
   - åˆ é™¤æ¨æ–‡ï¼ˆä»…é™è‡ªå·±çš„æ¨æ–‡ï¼‰
   - å›å¤æ¨æ–‡
   - è½¬å‘æ¨æ–‡
4. âœ… æ˜¾ç¤ºæ¨æ–‡æ€»æ•°
5. âœ… åŠ è½½çŠ¶æ€éª¨æ¶å±
6. âœ… é”™è¯¯å¤„ç†å’Œç©ºçŠ¶æ€æç¤º

### åç«¯åŠŸèƒ½

ä½¿ç”¨ç°æœ‰çš„ `/api/v1/tweets/list` æ¥å£ï¼š

- âœ… æ”¯æŒ `type=user` å‚æ•°è·å–æŒ‡å®šç”¨æˆ·çš„æ¨æ–‡
- âœ… æ”¯æŒåˆ†é¡µå‚æ•° `page` å’Œ `pageSize`
- âœ… è¿”å›æ¨æ–‡æ€»æ•° `totalCount`
- âœ… åŒ…å«ç”¨æˆ·ç‚¹èµå’Œæ”¶è—çŠ¶æ€

## æŠ€æœ¯å®ç°

### å‰ç«¯å®ç°

#### 1. æ•°æ®è·å–

ä½¿ç”¨ `useApiFetch` ç»„åˆå¼å‡½æ•°è·å–æ¨æ–‡åˆ—è¡¨ï¼š

```typescript
const {
  data: listApiResponse,
  pending: listPending,
  error: listError
} = useApiFetch<TweetListApiResponse>(
  '/api/v1/tweets/list',
  {
    query: {
      type: 'user',
      userId: userId,
      page: page,
      pageSize: pageSize
    },
    watch: [page]
  }
);
```

#### 2. æ¨æ–‡è¯¦æƒ…è·å–

ç›‘å¬æ¨æ–‡åˆ—è¡¨å˜åŒ–ï¼Œæ‰¹é‡è·å–è¯¦æƒ…ï¼š

```typescript
watch(listApiResponse, async newListApiResponse => {
  if (!newListApiResponse?.data?.tweets) return;

  const basicTweets = newListApiResponse.data.tweets;
  const detailPromises = basicTweets.map(basicTweet =>
    apiFetch(`/api/v1/tweets/${basicTweet.tweetId}`)
  );

  const detailResults = await Promise.all(detailPromises);
  fullTweets.value = detailResults.map((res: any) => ({
    ...res.data?.tweet,
    id: res.data?.tweet.tweetId
  }));
});
```

#### 3. æ¨æ–‡æ“ä½œ

å®ç°äº†å®Œæ•´çš„æ¨æ–‡äº¤äº’åŠŸèƒ½ï¼š

```typescript
// ç‚¹èµ/å–æ¶ˆç‚¹èµ
async function handleLikeTweet(
  tweet: any,
  action: 'like' | 'unlike'
) {
  const response = await apiFetch(
    '/api/v1/interactions/like',
    {
      method: 'POST',
      body: { tweetId: tweet.tweetId, likeType: action }
    }
  );
  // æ›´æ–°æœ¬åœ°çŠ¶æ€
}

// æ”¶è—/å–æ¶ˆæ”¶è—
async function handleBookmarkTweet(
  tweet: any,
  action: 'mark' | 'unmark'
) {
  const response = await apiFetch(
    '/api/v1/interactions/bookmark',
    {
      method: 'POST',
      body: { tweetId: tweet.tweetId, bookmarkType: action }
    }
  );
}

// åˆ é™¤æ¨æ–‡
async function handleDeleteTweet(tweetId: string) {
  const response = await apiFetch(
    `/api/v1/tweets/${tweetId}`,
    {
      method: 'DELETE'
    }
  );
}
```

#### 4. åˆ†é¡µç»„ä»¶

ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„ Pagination ç»„ä»¶ï¼š

```vue
<Pagination
  v-model:page="page"
  :items-per-page="pageSize"
  :total="totalTweets"
>
  <PaginationContent v-slot="{ items }">
    <PaginationPrevious />
    <template v-for="(item, index) in items" :key="index">
      <PaginationItem
        v-if="item.type === 'page'"
        :value="item.value"
        :is-active="item.value === page"
      >
        {{ item.value }}
      </PaginationItem>
    </template>
    <PaginationNext />
  </PaginationContent>
</Pagination>
```

### åç«¯å®ç°

åç«¯å·²æœ‰å®Œæ•´å®ç°ï¼Œä½äº `server/api/v1/tweets/list.get.ts`ï¼š

#### API æ¥å£

- **è·¯å¾„**: `/api/v1/tweets/list`
- **æ–¹æ³•**: GET
- **å‚æ•°**:
  - `type`: 'user' (è·å–æŒ‡å®šç”¨æˆ·çš„æ¨æ–‡)
  - `userId`: ç›®æ ‡ç”¨æˆ·ID
  - `page`: é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
  - `pageSize`: æ¯é¡µæ•°é‡

#### SQL æŸ¥è¯¢

```sql
SELECT *
FROM (
    SELECT
        v.tweet_id,
        v.author_id,
        v.username,
        v.display_name,
        v.avatar_url,
        v.is_verified,
        v.likes_count,
        v.retweets_count,
        v.replies_count,
        v.views_count,
        v.visibility,
        v.created_at,
        v.reply_to_tweet_id,
        v.retweet_of_tweet_id,
        v.quote_tweet_id,
        v.engagement_score,
        v.timeline_type,
        v.is_from_following,
        ROW_NUMBER() OVER (ORDER BY v.created_at DESC) AS rn,
        CASE
            WHEN EXISTS (SELECT 1 FROM n_likes l
                         WHERE l.tweet_id = v.tweet_id
                         AND l.user_id = :user_id)
            THEN 1 ELSE 0
        END AS is_liked_by_user,
        CASE
            WHEN EXISTS (SELECT 1 FROM n_bookmarks b
                         WHERE b.tweet_id = v.tweet_id
                         AND b.user_id = :user_id)
            THEN 1 ELSE 0
        END AS is_booked_by_user
    FROM v_comprehensive_timeline v
    WHERE v.author_id = :target_user_id
      AND fn_can_view_tweet(:user_id, v.tweet_id) = 1
)
WHERE rn > (:page - 1) * :pagesize
  AND rn <= :page * :pagesize
ORDER BY created_at DESC
```

#### å“åº”æ ¼å¼

```typescript
{
  success: true,
  message: 'è·å–æ¨æ–‡åˆ—è¡¨æˆåŠŸ',
  data: {
    type: 'user',
    page: 1,
    pageSize: 15,
    tweets: [...],
    totalCount: 42
  },
  code: 200,
  timestamp: '2025-11-25T...'
}
```

## UI å±•ç¤º

### é¡µé¢ç»“æ„

```
ç”¨æˆ·ä¸ªäººèµ„æ–™é¡µ
â”œâ”€â”€ ç”¨æˆ·å¤´åƒå’Œä¿¡æ¯å¡ç‰‡
â”œâ”€â”€ ç»Ÿè®¡æ•°æ®é¢æ¿
â””â”€â”€ ç”¨æˆ·æ¨æ–‡åˆ—è¡¨å¡ç‰‡
    â”œâ”€â”€ æ ‡é¢˜å’Œæ¨æ–‡æ€»æ•°
    â”œâ”€â”€ æ¨æ–‡åˆ—è¡¨
    â”‚   â”œâ”€â”€ æ¨æ–‡å¡ç‰‡ 1
    â”‚   â”œâ”€â”€ æ¨æ–‡å¡ç‰‡ 2
    â”‚   â””â”€â”€ ...
    â””â”€â”€ åˆ†é¡µç»„ä»¶
```

### çŠ¶æ€å±•ç¤º

1. **åŠ è½½ä¸­**: æ˜¾ç¤º3ä¸ªéª¨æ¶å±å¡ç‰‡
2. **åŠ è½½å¤±è´¥**: æ˜¾ç¤ºé”™è¯¯æç¤ºä¿¡æ¯
3. **æ¨æ–‡åˆ—è¡¨**: æ˜¾ç¤ºæ¨æ–‡å¡ç‰‡åˆ—è¡¨å’Œåˆ†é¡µ
4. **æ— æ¨æ–‡**: æ˜¾ç¤º"è¯¥ç”¨æˆ·è¿˜æ²¡æœ‰å‘å¸ƒæ¨æ–‡"

## ç»„ä»¶å¤ç”¨

### ä½¿ç”¨çš„å…±äº«ç»„ä»¶

1. `TweetList.vue` - æ¨æ–‡åˆ—è¡¨å®¹å™¨
2. `TweetCard.vue` - å•ä¸ªæ¨æ–‡å¡ç‰‡
3. `TweetCardSkeleton.vue` - åŠ è½½éª¨æ¶å±
4. `Pagination` ç³»åˆ—ç»„ä»¶ - åˆ†é¡µæ§ä»¶

### ä¿æŒé£æ ¼ä¸€è‡´

- ä¸ `/tweet/[type]/[user]` é¡µé¢ä½¿ç”¨ç›¸åŒçš„æ¨æ–‡å±•ç¤ºç»„ä»¶
- ä¸é¡¹ç›®å…¶ä»–é¡µé¢ä½¿ç”¨ç›¸åŒçš„ Cardã€Separator ç­‰ UI ç»„ä»¶
- éµå¾ªé¡¹ç›®ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€å±•ç¤ºæ–¹å¼

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•

1. âœ… è®¿é—®ç”¨æˆ·ä¸ªäººèµ„æ–™é¡µï¼ŒæŸ¥çœ‹æ¨æ–‡åˆ—è¡¨
2. âœ… æµ‹è¯•åˆ†é¡µåŠŸèƒ½ï¼Œç¿»é¡µæŸ¥çœ‹æ›´å¤šæ¨æ–‡
3. âœ… æµ‹è¯•æ¨æ–‡äº¤äº’æ“ä½œï¼ˆç‚¹èµã€æ”¶è—ï¼‰
4. âœ… æµ‹è¯•åˆ é™¤è‡ªå·±çš„æ¨æ–‡
5. âœ… æµ‹è¯•ç©ºçŠ¶æ€ï¼ˆè®¿é—®æ²¡æœ‰æ¨æ–‡çš„ç”¨æˆ·ï¼‰
6. âœ… æµ‹è¯•åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

### æ€§èƒ½æµ‹è¯•

1. æµ‹è¯•æ¨æ–‡æ•°é‡è¾ƒå¤šæ—¶çš„åŠ è½½é€Ÿåº¦
2. éªŒè¯åˆ†é¡µåŠ è½½çš„å“åº”æ—¶é—´
3. æ£€æŸ¥å¹¶å‘è¯·æ±‚çš„å¤„ç†

## ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶

- `pages/user/[id]/profile.vue` - ç”¨æˆ·ä¸ªäººèµ„æ–™é¡µé¢

### ç›¸å…³çš„ç°æœ‰æ–‡ä»¶

- `server/api/v1/tweets/list.get.ts` - æ¨æ–‡åˆ—è¡¨API
- `server/api/v1/tweets/[tweetId].get.ts` - æ¨æ–‡è¯¦æƒ…API
- `server/api/v1/interactions/like.post.ts` - ç‚¹èµAPI
- `server/api/v1/interactions/bookmark.post.ts` - æ”¶è—API
- `components/TweetList.vue` - æ¨æ–‡åˆ—è¡¨ç»„ä»¶
- `components/TweetCard.vue` - æ¨æ–‡å¡ç‰‡ç»„ä»¶
- `components/TweetCardSkeleton.vue` - éª¨æ¶å±ç»„ä»¶

## æ³¨æ„äº‹é¡¹

1. **æƒé™æ§åˆ¶**: åç«¯ä½¿ç”¨ `fn_can_view_tweet` å‡½æ•°æ£€æŸ¥æŸ¥çœ‹æƒé™
2. **æ€§èƒ½ä¼˜åŒ–**: æ¨æ–‡è¯¦æƒ…ä½¿ç”¨ `Promise.all` æ‰¹é‡è·å–ï¼Œæé«˜æ€§èƒ½
3. **çŠ¶æ€åŒæ­¥**: ç‚¹èµå’Œæ”¶è—æ“ä½œåç«‹å³æ›´æ–°æœ¬åœ°çŠ¶æ€ï¼Œæä¾›å³æ—¶åé¦ˆ
4. **é”™è¯¯å¤„ç†**: æ‰€æœ‰APIè°ƒç”¨éƒ½åŒ…å«é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
5. **å“åº”å¼è®¾è®¡**: ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„ Card å¸ƒå±€ï¼Œé€‚é…ç§»åŠ¨ç«¯

## æœªæ¥æ”¹è¿›

1. ğŸ”„ æ·»åŠ ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½
2. ğŸ”„ æ·»åŠ æ¨æ–‡ç­›é€‰åŠŸèƒ½ï¼ˆä»…åª’ä½“ã€ä»…å›å¤ç­‰ï¼‰
3. ğŸ”„ ä¼˜åŒ–æ¨æ–‡è¯¦æƒ…è·å–ï¼ˆè€ƒè™‘æ‰¹é‡æ¥å£ï¼‰
4. ğŸ”„ æ·»åŠ è™šæ‹Ÿæ»šåŠ¨æ”¯æŒå¤§é‡æ¨æ–‡
5. ğŸ”„ æ·»åŠ æ¨æ–‡æœç´¢åŠŸèƒ½

---

**å®ç°æ—¶é—´**: 2025-11-25
**å®ç°è€…**: GitHub Copilot
**ç‰ˆæœ¬**: v1.0.0
